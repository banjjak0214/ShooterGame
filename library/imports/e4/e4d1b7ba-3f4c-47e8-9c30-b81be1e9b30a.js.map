{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\script\\gameOver/assets\\script\\gameOver\\gameOver.js"],"names":["CHD","require","GameData","cc","Class","extends","Component","properties","subCanvas","default","type","Sprite","gameNode","Node","rankViewNode","againBtn","homeBtn","shareBtn","maxScoreLabel","Label","scoreLabel","groupBtn","start","window","wx","undefined","showShareMenu","withShareTicket","tex","Texture2D","sharedCanvas","width","height","on","getChildByName","active","director","loadScene","shareAppMessage","init","setScore","y","runEffect","stopAllActions","runAction","sequence","moveTo","maxScore","getMaxScore","score","setMaxScore","string","convertNum","_updateSubCanvas","initWithElement","handleLoadedTexture","spriteFrame","SpriteFrame","update","onEnable","rankList","num","Math","round"],"mappings":";;;;;;AAAA,IAAIA,MAAMC,QAAQ,eAAR,CAAV;AACA,IAAIC,WAAWD,QAAQ,UAAR,CAAf;AACAE,GAAGC,KAAH,CAAS;AACLC,aAASF,GAAGG,SADP;;AAGLC,gBAAY;AACRC,mBAAW;AACPC,qBAAS,IADF;AAEPC,kBAAMP,GAAGQ;AAFF,SADH;AAKRC,kBAAST,GAAGU,IALJ;AAMRC,sBAAcX,GAAGU,IANT;AAORE,kBAAUZ,GAAGU,IAPL;AAQRG,iBAASb,GAAGU,IARJ;AASRI,kBAAUd,GAAGU,IATL;AAURK,uBAAef,GAAGgB,KAVV;AAWRC,oBAAYjB,GAAGgB,KAXP;AAYRE,kBAASlB,GAAGU;AAZJ,KAHP;;AAkBL;;AAEA;;AAEAS,SAtBK,mBAsBI;AACL,YAAIC,OAAOC,EAAP,IAAaC,SAAjB,EAA4B;AACxBF,mBAAOC,EAAP,CAAUE,aAAV,CAAwB,EAACC,iBAAiB,IAAlB,EAAxB;AACA,iBAAKC,GAAL,GAAW,IAAIzB,GAAG0B,SAAP,EAAX;AACAN,mBAAOO,YAAP,CAAoBC,KAApB,GAA4B,IAA5B;AACAR,mBAAOO,YAAP,CAAoBE,MAApB,GAA6B,IAA7B;AACH;;AAED,aAAKjB,QAAL,CAAckB,EAAd,CAAiB,YAAjB,EAA+B,YAAW;AACtC,iBAAKlB,QAAL,CAAcmB,cAAd,CAA6B,OAA7B,EAAsCC,MAAtC,GAA+C,IAA/C;AACH,SAFD,EAEG,IAFH;AAGA,aAAKpB,QAAL,CAAckB,EAAd,CAAiB,UAAjB,EAA6B,YAAW;AACpC,iBAAKlB,QAAL,CAAcmB,cAAd,CAA6B,OAA7B,EAAsCC,MAAtC,GAA+C,KAA/C;AACAhC,eAAGiC,QAAH,CAAYC,SAAZ,CAAsB,MAAtB;AACH,SAHD,EAGG,IAHH;AAIA,aAAKtB,QAAL,CAAckB,EAAd,CAAiB,aAAjB,EAAgC,YAAW;AACvC,iBAAKlB,QAAL,CAAcmB,cAAd,CAA6B,OAA7B,EAAsCC,MAAtC,GAA+C,KAA/C;AACH,SAFD,EAEG,IAFH;;AAIA,aAAKnB,OAAL,CAAaiB,EAAb,CAAgB,YAAhB,EAA8B,YAAW;AACrC,iBAAKjB,OAAL,CAAakB,cAAb,CAA4B,OAA5B,EAAqCC,MAArC,GAA8C,IAA9C;AACH,SAFD,EAEG,IAFH;AAGA,aAAKnB,OAAL,CAAaiB,EAAb,CAAgB,UAAhB,EAA4B,YAAW;AACnC,iBAAKjB,OAAL,CAAakB,cAAb,CAA4B,OAA5B,EAAqCC,MAArC,GAA8C,KAA9C;AACAhC,eAAGiC,QAAH,CAAYC,SAAZ,CAAsB,MAAtB;AACH,SAHD,EAGG,IAHH;AAIA,aAAKrB,OAAL,CAAaiB,EAAb,CAAgB,aAAhB,EAA+B,YAAW;AACtC,iBAAKjB,OAAL,CAAakB,cAAb,CAA4B,OAA5B,EAAqCC,MAArC,GAA8C,KAA9C;AACH,SAFD,EAEG,IAFH;;AAIA,aAAKlB,QAAL,CAAcgB,EAAd,CAAiB,YAAjB,EAA+B,YAAW;AACtC,iBAAKhB,QAAL,CAAciB,cAAd,CAA6B,OAA7B,EAAsCC,MAAtC,GAA+C,IAA/C;AACH,SAFD,EAEG,IAFH;AAGA,aAAKlB,QAAL,CAAcgB,EAAd,CAAiB,UAAjB,EAA6B,YAAW;AACpC,iBAAKhB,QAAL,CAAciB,cAAd,CAA6B,OAA7B,EAAsCC,MAAtC,GAA+C,KAA/C;AACAnC,gBAAIsC,eAAJ,CAAoB,WAApB,EAAiC,eAAjC;AACH,SAHD,EAGG,IAHH;AAIA,aAAKrB,QAAL,CAAcgB,EAAd,CAAiB,aAAjB,EAAgC,YAAW;AACvC,iBAAKhB,QAAL,CAAciB,cAAd,CAA6B,OAA7B,EAAsCC,MAAtC,GAA+C,KAA/C;AACH,SAFD,EAEG,IAFH;;AAIA;AACA;AACA;AACA,aAAKI,IAAL;AACH,KAnEI;AAoELA,QApEK,kBAoEC;AACF,aAAKC,QAAL;AACA,aAAKzB,QAAL,CAAc0B,CAAd,GAAkB,CAAC,GAAnB;AACA,aAAKpB,QAAL,CAAcoB,CAAd,GAAkB,CAAC,GAAnB;AACA,aAAKC,SAAL;AAEH,KA1EI;AA2ELA,aA3EK,uBA2EM;AACP,aAAK3B,QAAL,CAAc4B,cAAd;AACA,aAAK5B,QAAL,CAAc6B,SAAd,CAAwBzC,GAAG0C,QAAH,CACpB1C,GAAG2C,MAAH,CAAU,GAAV,EAAe,CAAf,EAAkB,CAAC,EAAnB,CADoB,EAEpB3C,GAAG2C,MAAH,CAAU,IAAV,EAAgB,CAAhB,EAAmB,CAAC,EAApB,CAFoB,EAGpB3C,GAAG2C,MAAH,CAAU,IAAV,EAAgB,CAAhB,EAAmB,CAAC,EAApB,CAHoB,CAAxB;;AAMA,aAAKzB,QAAL,CAAcsB,cAAd;AACA,aAAKtB,QAAL,CAAcuB,SAAd,CAAwBzC,GAAG0C,QAAH,CACpB1C,GAAG2C,MAAH,CAAU,IAAV,EAAgB,CAAhB,EAAmB,CAAC,GAApB,CADoB,EAEpB3C,GAAG2C,MAAH,CAAU,IAAV,EAAgB,CAAhB,EAAmB,CAAC,GAApB,CAFoB,EAGpB3C,GAAG2C,MAAH,CAAU,IAAV,EAAgB,CAAhB,EAAmB,CAAC,GAApB,CAHoB,CAAxB;AAMH,KA1FI;AA2FLN,YA3FK,sBA2FM;AACP,YAAIO,WAAW/C,IAAIgD,WAAJ,EAAf;AACA,YAAIC,QAAQ/C,SAAS+C,KAArB;AACA,YAAIF,WAAWE,KAAf,EAAsB;AAClBF,uBAAWE,KAAX;AACA;AACAjD,gBAAIkD,WAAJ,CAAgBD,KAAhB;AACH;AACD;AACA;AACA;;AAEA,aAAK/B,aAAL,CAAmBiC,MAAnB,GAA4B,WAAW,KAAKC,UAAL,CAAgBH,KAAhB,CAAvC;AACA,aAAK7B,UAAL,CAAgB+B,MAAhB,GAAyB,WAAW,KAAKC,UAAL,CAAgBL,QAAhB,CAApC;AACH,KAzGI;AA0GLM,oBA1GK,8BA0Gc;AACf,YAAI9B,OAAOO,YAAP,IAAuBL,SAAvB,IAAoC,KAAKG,GAA7C,EAAkD;AAC9C,iBAAKA,GAAL,CAAS0B,eAAT,CAAyB/B,OAAOO,YAAhC;AACA,iBAAKF,GAAL,CAAS2B,mBAAT;AACA,iBAAK/C,SAAL,CAAegD,WAAf,GAA6B,IAAIrD,GAAGsD,WAAP,CAAmB,KAAK7B,GAAxB,CAA7B;AACH;AACJ,KAhHI;AAiHL8B,UAjHK,oBAiHI;AACL,aAAKL,gBAAL;AACH,KAnHI;AAoHLM,YApHK,sBAoHM;AACP;AACA;AACA3D,YAAI4D,QAAJ,CAAa,UAAb;AACH,KAxHI;AAyHLR,cAzHK,sBAyHMS,GAzHN,EAyHU;AACX,YAAGA,MAAM,CAAT,EAAY,OAAO,CAAP;AACZ,YAAGA,OAAO,IAAV,EAAe;AACX,mBAAOC,KAAKC,KAAL,CAAWF,MAAI,EAAf,IAAmB,GAAnB,GAAyB,GAAhC;AACH;AACD,eAAOA,GAAP;AACH;AA/HI,CAAT","file":"gameOver.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\script\\gameOver","sourcesContent":["var CHD = require(\"commonHandler\");\r\nvar GameData = require(\"gameData\");\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        subCanvas: {\r\n            default: null,\r\n            type: cc.Sprite\r\n        },\r\n        gameNode:cc.Node,\r\n        rankViewNode: cc.Node,\r\n        againBtn: cc.Node,\r\n        homeBtn: cc.Node,\r\n        shareBtn: cc.Node,\r\n        maxScoreLabel: cc.Label,\r\n        scoreLabel: cc.Label,\r\n        groupBtn:cc.Node\r\n    },\r\n\r\n    // LIFE-CYCLE CALLBACKS:\r\n\r\n    // onLoad () {},\r\n\r\n    start () {\r\n        if (window.wx != undefined) {\r\n            window.wx.showShareMenu({withShareTicket: true});\r\n            this.tex = new cc.Texture2D();\r\n            window.sharedCanvas.width = 1080;\r\n            window.sharedCanvas.height = 1920;\r\n        }\r\n\r\n        this.againBtn.on('touchstart', function() {\r\n            this.againBtn.getChildByName('cover').active = true;\r\n        }, this);\r\n        this.againBtn.on('touchend', function() {\r\n            this.againBtn.getChildByName('cover').active = false;\r\n            cc.director.loadScene('game');\r\n        }, this);\r\n        this.againBtn.on('touchcancel', function() {\r\n            this.againBtn.getChildByName('cover').active = false;\r\n        }, this);\r\n\r\n        this.homeBtn.on('touchstart', function() {\r\n            this.homeBtn.getChildByName('cover').active = true;\r\n        }, this);\r\n        this.homeBtn.on('touchend', function() {\r\n            this.homeBtn.getChildByName('cover').active = false;\r\n            cc.director.loadScene('home');\r\n        }, this);\r\n        this.homeBtn.on('touchcancel', function() {\r\n            this.homeBtn.getChildByName('cover').active = false;\r\n        }, this);\r\n\r\n        this.shareBtn.on('touchstart', function() {\r\n            this.shareBtn.getChildByName('cover').active = true;\r\n        }, this);\r\n        this.shareBtn.on('touchend', function() {\r\n            this.shareBtn.getChildByName('cover').active = false;\r\n            CHD.shareAppMessage('hitBricks', 'hitBricks.jpg');\r\n        }, this);\r\n        this.shareBtn.on('touchcancel', function() {\r\n            this.shareBtn.getChildByName('cover').active = false;\r\n        }, this);\r\n\r\n        // this.node.on('touchstart', function(event){\r\n        //     event.stopPropagation();\r\n        // }, this);\r\n        this.init();\r\n    },\r\n    init(){\r\n        this.setScore();\r\n        this.againBtn.y = -340;\r\n        this.groupBtn.y = -430;\r\n        this.runEffect();\r\n        \r\n    },\r\n    runEffect(){\r\n        this.againBtn.stopAllActions();\r\n        this.againBtn.runAction(cc.sequence(\r\n            cc.moveTo(0.2, 0, -49),\r\n            cc.moveTo(0.05, 0, -10),\r\n            cc.moveTo(0.07, 0, -49)\r\n        ));\r\n\r\n        this.groupBtn.stopAllActions();\r\n        this.groupBtn.runAction(cc.sequence(\r\n            cc.moveTo(0.15, 0, -280),\r\n            cc.moveTo(0.05, 0, -255),\r\n            cc.moveTo(0.07, 0, -280)\r\n        ))\r\n        \r\n    },\r\n    setScore() {\r\n        let maxScore = CHD.getMaxScore();\r\n        let score = GameData.score;\r\n        if (maxScore < score) {\r\n            maxScore = score;\r\n            // CHD.rankList(\"gameOver\", maxScore);\r\n            CHD.setMaxScore(score);\r\n        }\r\n        // else{\r\n        //     CHD.rankList(\"gameOver\");\r\n        // }\r\n        \r\n        this.maxScoreLabel.string = \"本局得分: \" + this.convertNum(score);\r\n        this.scoreLabel.string = \"历史最高: \" + this.convertNum(maxScore);\r\n    },\r\n    _updateSubCanvas() {\r\n        if (window.sharedCanvas != undefined && this.tex) {\r\n            this.tex.initWithElement(window.sharedCanvas);\r\n            this.tex.handleLoadedTexture();\r\n            this.subCanvas.spriteFrame = new cc.SpriteFrame(this.tex);\r\n        }\r\n    },\r\n    update() {\r\n        this._updateSubCanvas();\r\n    },\r\n    onEnable() {\r\n        // this.setScore();\r\n        // console.log('ranklist');\r\n        CHD.rankList(\"gameOver\");\r\n    },\r\n    convertNum(num){\r\n        if(num < 0) return 0;\r\n        if(num >= 1000){\r\n            return Math.round(num/10)/100 + 'K';\r\n        }\r\n        return num;\r\n    }\r\n});\r\n"]}