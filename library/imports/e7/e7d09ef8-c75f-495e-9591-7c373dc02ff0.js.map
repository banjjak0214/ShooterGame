{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\script\\game/assets\\script\\game\\block.js"],"names":["GameData","require","cc","Class","extends","Component","properties","lblVal","Label","hitAudio","AudioClip","deadAudio","start","node","on","explore","_isSound","audioEngine","play","update","dt","parent","y","endLine","name","blockPool","put","removeFromParent","onCollisionEnter","other","self","exploreALL","active","decreaseN","bulletPower","bulletSpeed","cVal","_value","score","game","changeScoreView","emit","exploreAllBlocks","audioCount","audioSkip","rate","R","_color","G","B","changeColor","changeValue","init","val","rColor","gColor","bColor","isSound","_initColor","Color","bulletMulti","getValue","txtVal","Math","round","string","color","blastPool","size","blast","get","setPosition","x","getComponent","ParticleSystem","startColor","endColor","resetSystem","scheduleOnce","removeSelf"],"mappings":"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","file":"block.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\script\\game","sourcesContent":["// var CHD = require(\"commonHandler\");\r\nvar GameData = require(\"gameData\");\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        lblVal:cc.Label,\r\n        hitAudio:cc.AudioClip,\r\n        deadAudio:cc.AudioClip\r\n    },\r\n    start () {\r\n        this.node.on('explore', function(){\r\n            this.explore();\r\n        }, this);\r\n        this.node.on('playHit', function(){\r\n            if(!this._isSound) return;\r\n            cc.audioEngine.play(this.hitAudio, false, 0.6);\r\n        }, this)\r\n        this.node.on('playDead', function(){\r\n            if(!this._isSound) return;\r\n            cc.audioEngine.play(this.deadAudio, false, 0.5);\r\n        }, this)\r\n    },\r\n\r\n    update (dt) {\r\n        if(this.node.parent.y + this.node.y < GameData.endLine-50){\r\n            if(this.node.name == 'block'){\r\n                GameData.blockPool.put(this.node);\r\n            }else{\r\n                this.node.removeFromParent();\r\n            }\r\n        }\r\n    },\r\n    onCollisionEnter(other, self) {\r\n        // if(this.node.parent == null) return;\r\n        if(GameData.exploreALL) return;\r\n        if (other.node.name == 'cbullet' || other.node.name == 'rbullet' || other.node.name == 'lbullet') {\r\n            other.node.active = false;\r\n\r\n            let decreaseN = GameData.bulletPower;\r\n            if(GameData.bulletSpeed > 15){\r\n                decreaseN += GameData.bulletSpeed - 15;\r\n            }\r\n\r\n            let cVal = this._value - decreaseN;\r\n\r\n            if (cVal <= 0) {\r\n                GameData.score += this._value;\r\n                GameData.game.changeScoreView();\r\n                this.node.emit('playDead');\r\n                if(this.node.name == 'starBlock'){\r\n                    this.node.active = false;\r\n                    // GameData.exploreALL = true;\r\n                    GameData.game.exploreAllBlocks();\r\n                }else{\r\n                    this.explore();\r\n                    // this.node.emit('explore');\r\n                }\r\n            }else{\r\n                GameData.score += decreaseN;\r\n                GameData.game.changeScoreView();\r\n                if(this.audioCount >= this.audioSkip){\r\n                    this.node.emit('playHit');\r\n                    this.audioCount = 0;\r\n                }else{\r\n                    this.audioCount += 1;\r\n                }\r\n                \r\n                let rate = cVal/this._value;\r\n                let R = this._color[0];\r\n                let G = this._color[1];\r\n                let B = this._color[2];\r\n                if(R < 200){\r\n                    R = 205;\r\n                    G = 25;\r\n                    B = 25;\r\n                }\r\n                this.changeColor(rate*( R - 255) + 255, rate*( G - 200) + 200, rate* B);\r\n                this.changeValue(cVal);\r\n            }\r\n        }\r\n    },\r\n    init(val, rColor, gColor, bColor){\r\n        this._isSound = GameData.isSound;\r\n        this.changeValue(val);\r\n        this._initColor = new cc.Color(rColor, gColor, bColor);\r\n        this.changeColor( rColor, gColor, bColor);\r\n        this.audioSkip = GameData.bulletMulti-1;\r\n        if(GameData.bulletSpeed > 8) this.audioSkip += 4;\r\n        this.audioCount = 0;\r\n    },\r\n    getValue(){\r\n        return this._value;\r\n    },\r\n    changeValue(val){\r\n        this._value = val;\r\n        let txtVal = val;\r\n        if(txtVal >= 1000){\r\n            txtVal = Math.round(txtVal/10)/100 + 'K';\r\n        }\r\n        this.lblVal.string = txtVal;\r\n    },\r\n    changeColor(rColor, gColor, bColor){\r\n        this._color = [rColor, gColor, bColor];\r\n        this.node.color = new cc.Color(rColor, gColor, bColor);\r\n    },\r\n    explore(){\r\n        // console.log('block Expore');\r\n        let self = this;\r\n        this.node.active = false;\r\n        if (GameData.blastPool.size() > 0) {\r\n            let blast = GameData.blastPool.get();\r\n            blast.setPosition(this.node.x, this.node.y);\r\n            blast.parent = this.node.parent;\r\n            blast.getComponent(cc.ParticleSystem).startColor = this._initColor;\r\n            blast.getComponent(cc.ParticleSystem).endColor = this._initColor;\r\n\r\n            blast.getComponent(cc.ParticleSystem).resetSystem();\r\n            this.scheduleOnce(() => {\r\n                GameData.blastPool.put(blast);\r\n                self.removeSelf();\r\n            }, 0.8);\r\n        }else{\r\n            self.removeSelf();\r\n        }\r\n\r\n    },\r\n    removeSelf(){\r\n        if(this.node.name == 'block'){\r\n            GameData.blockPool.put(this.node);\r\n        }else{\r\n            this.node.removeFromParent();\r\n        }\r\n    }\r\n});\r\n"]}